<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>åŸå¸‚åº”æ€¥æ¨¡æ‹Ÿå¯è§†åŒ–</title>
  <!-- æ·»åŠ mpld3æ‰€éœ€çš„JavaScriptåº“ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.17/d3.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mpld3/0.3.1/mpld3.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 30px;
      background-color: #f5f5f5;
    }
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    label {
      display: inline-block;
      width: 220px;
      margin-top: 10px;
      color: #333;
    }
    input {
      width: 80px;
      padding: 5px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }
    button {
      margin: 10px 5px;
      padding: 8px 16px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #45a049;
    }
    #plotContainer {
      margin-top: 20px;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background-color: white;
      min-height: 400px;
    }
    .loading {
      text-align: center;
      padding: 20px;
      color: #666;
    }
    /* æ·»åŠ äº¤äº’å¼å›¾è¡¨çš„æ ·å¼ */
    .mpld3-figure {
      width: 100%;
      height: 600px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸš¨ åŸå¸‚åº”æ€¥æ•‘æ´æ¨¡æ‹Ÿ</h1>

    <form id="simForm">
      <label>æ•‘æ´äººå‘˜æ•°é‡ï¼š
        <input type="number" name="num_rescuers" value="{{ params.NUM_RESCUERS }}" min="1" required>
      </label><br>
      <label>æ¯äººæœ€å¤§æ•‘æ´èƒ½åŠ›ï¼š
        <input type="number" name="capacity" value="{{ params.MAX_RESCUE_CAPACITY }}" min="1" required>
      </label><br>
      <label>æœ€å¤§ç§»åŠ¨é€Ÿåº¦ï¼š
        <input type="number" name="speed" value="{{ params.MAX_SPEED }}" min="1" required>
      </label><br>

      <button type="submit">â–¶ï¸ å¼€å§‹æ¨¡æ‹Ÿ</button>
      <button type="button" onclick="refreshImage()">ğŸ–¼ï¸ åˆ·æ–°å›¾åƒ</button>
      <button type="button" onclick="resetParams()">ğŸ”„ é‡ç½®å‚æ•°</button>
    </form>

    <div id="plotContainer">
      <div class="loading">ç­‰å¾…æ¨¡æ‹Ÿå¼€å§‹...</div>
    </div>
  </div>

  <script>
    const form = document.getElementById('simForm');
    const plotContainer = document.getElementById('plotContainer');

    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    function showLoading() {
      plotContainer.innerHTML = '<div class="loading">æ­£åœ¨ç”Ÿæˆå¯è§†åŒ–...</div>';
    }

    // æäº¤æ¨¡æ‹Ÿè¯·æ±‚
    form.addEventListener('submit', function (e) {
      e.preventDefault();
      const formData = new FormData(form);
      showLoading();

      fetch('/start', {
        method: 'POST',
        body: formData
      })
      .then(res => res.json())
      .then(data => {
        console.log('[å¼€å§‹æ¨¡æ‹Ÿ]', data);
        refreshImage();
      })
      .catch(error => {
        console.error('Error:', error);
        plotContainer.innerHTML = '<div class="loading">æ¨¡æ‹Ÿè¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•</div>';
      });
    });

function refreshImage() {
  showLoading();
  fetch('/plot', {
    method: 'POST'
  })
  .then(res => res.json())
  .then(data => {
    plotContainer.innerHTML = `
      <video controls autoplay loop width="100%">
        <source src="${data.video}" type="video/mp4">
        Your browser does not support the video tag.
      </video>`;
  })
  .catch(error => {
    console.error('Error:', error);
    plotContainer.innerHTML = '<div class="loading">è·å–å›¾åƒæ—¶å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•</div>';
  });
}



    // é‡ç½®å‚æ•°
    function resetParams() {
      showLoading();
      fetch('/reset', {
        method: 'POST'
      })
      .then(() => {
        location.reload();
      })
      .catch(error => {
        console.error('Error:', error);
        plotContainer.innerHTML = '<div class="loading">é‡ç½®å‚æ•°æ—¶å‡ºç°é”™è¯¯ï¼Œè¯·é‡è¯•</div>';
      });
    }
  </script>
</body>
</html>
